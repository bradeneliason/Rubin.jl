using Rubin
using Tests
using Elliptic
using HypergeometricFunctions
using Polylogarithms
using SpecialFunctions

@test integrate((a+a*cos(x))^-1*sin(x)^4, x) == :((1/2)*x*a^-1+-1//3*a^-1*sin(x)^3+-1//2*a^-1*cos(x)*sin(x))
@test integrate((a+a*cos(x))^-1*sin(x)^3, x) == :((1/2)*a^-1*cos(x)^2+-1*a^-1*cos(x))
@test integrate((a+a*cos(x))^-1*sin(x)^2, x) == :(x*a^-1+-1*a^-1*sin(x))
@test integrate((a+a*cos(x))^-1*sin(x), x) == :(-1*a^-1*log(1+cos(x)))
@test integrate((a+a*cos(x))^-1, x) == :((a+a*cos(x))^-1*sin(x))
@test integrate((a+a*cos(x))^-1*csc(x), x) == :((2a+2*a*cos(x))^-1+-1//2*a^-1*arctanh(cos(x)))
@test integrate((a+a*cos(x))^-1*csc(x)^2, x) == :((3a+3*a*cos(x))^-1*csc(x)+-2//3*a^-1*cot(x))
@test integrate((a+a*cos(x))^-1*csc(x)^3, x) == :((4a+4*a*cos(x))^-1+-1*(8a+-8*a*cos(x))^-1+-3//8*a^-1*arctanh(cos(x))+1//8*a*(a+a*cos(x))^-2)
@test integrate((a+a*cos(x))^-1*csc(x)^4, x) == :((5a+5*a*cos(x))^-1*csc(x)^3+-4//5*a^-1*cot(x)+-4//15*a^-1*cot(x)^3)
@test integrate((1+cos(x))^-2*sin(x), x) == :((1+cos(x))^-1)
@test integrate((1+-1*cos(x))^-2*sin(x), x) == :(-1*(1+-1*cos(x))^-1)
@test integrate((1+cos(x))^-2*sin(x)^2, x) == :(-1x+2*(1+cos(x))^-1*sin(x))
@test integrate((1+-1*cos(x))^-2*sin(x)^2, x) == :(-1x+-2*(1+-1*cos(x))^-1*sin(x))
@test integrate((1+cos(x))^-2*sin(x)^3, x) == :(-2*log(1+cos(x))+cos(x))
@test integrate((1+-1*cos(x))^-2*sin(x)^3, x) == :(2*log(1+-1*cos(x))+cos(x))
@test integrate((1+cos(x))^-3*sin(x), x) == :((1/2)*(1+cos(x))^-2)
@test integrate((1+-1*cos(x))^-3*sin(x), x) == :(-1//2*(1+-1*cos(x))^-2)
@test integrate((1+cos(x))^-3*sin(x)^2, x) == :(1//3*(1+cos(x))^-3*sin(x)^3)
@test integrate((1+-1*cos(x))^-3*sin(x)^2, x) == :(-1//3*(1+-1*cos(x))^-3*sin(x)^3)
@test integrate((1+cos(x))^-3*sin(x)^3, x) == :(2*(1+cos(x))^-1+log(1+cos(x)))
@test integrate((1+-1*cos(x))^-3*sin(x)^3, x) == :(-1*log(1+-1*cos(x))+-2*(1+-1*cos(x))^-1)
@test integrate((a+b*cos(x))^-1*sin(x)^4, x) == :(-1//3*b^-1*sin(x)^3+(1/2)*b^-3*(-2*b^2+2*a^2+-1*a*b*cos(x))*sin(x)+2*b^-4*(a+b)^3//2*(a+-1b)^3//2*arctan((a+b)^-1//2*(a+-1b)^(1/2)*tan((1/2)*x))+-1//2*a*x*b^-4*(-3*b^2+2*a^2))
@test integrate((a+b*cos(x))^-1*sin(x)^3, x) == :((1/2)*b^-1*cos(x)^2+b^-3*(a^2+-1*b^2)*log(a+b*cos(x))+-1*a*b^-2*cos(x))
@test integrate((a+b*cos(x))^-1*sin(x)^2, x) == :(-1*b^-1*sin(x)+a*x*b^-2+-2*b^-2*(a+b)^(1/2)*(a+-1b)^(1/2)*arctan((a+b)^-1//2*(a+-1b)^(1/2)*tan((1/2)*x)))
@test integrate((a+b*cos(x))^-1*sin(x), x) == :(-1*b^-1*log(a+b*cos(x)))
@test integrate((a+b*cos(x))^-1, x) == :(2*(a+b)^-1//2*(a+-1b)^-1//2*arctan((a+b)^-1//2*(a+-1b)^(1/2)*tan((1/2)*x)))
@test integrate((a+b*cos(x))^-1*csc(x), x) == :((2a+2b)^-1*log(1+-1*cos(x))+-1*(-2b+2a)^-1*log(1+cos(x))+b*(a^2+-1*b^2)^-1*log(a+b*cos(x)))
@test integrate((a+b*cos(x))^-1*csc(x)^2, x) == :((a^2+-1*b^2)^-1*(b+-1*a*cos(x))*csc(x)+-2*b^2*(a+b)^-3//2*(a+-1b)^-3//2*arctan((a+b)^-1//2*(a+-1b)^(1/2)*tan((1/2)*x)))
@test integrate((a+b*cos(x))^-1*csc(x)^3, x) == :((-2*b^2+2*a^2)^-1*csc(x)^2*(b+-1*a*cos(x))+-1*b^3*(a^2+-1*b^2)^-2*log(a+b*cos(x))+-1//4*(a+-1b)^-2*(a+-2b)*log(1+cos(x))+1//4*(a+b)^-2*(a+2b)*log(1+-1*cos(x)))
@test integrate((a+b*cos(x))^-1*csc(x)^4, x) == :((-3*b^2+3*a^2)^-1*csc(x)^3*(b+-1*a*cos(x))+-1//3*(a^2+-1*b^2)^-2*(3*b^3+a*(-5*b^2+2*a^2)*cos(x))*csc(x)+2*b^4*(a+b)^-5//2*(a+-1b)^-5//2*arctan((a+b)^-1//2*(a+-1b)^(1/2)*tan((1/2)*x)))
@test integrate((e*sin(c+d*x))^7//2*(a+b*cos(c+d*x)), x) == :(2//9*b*d^-1*e^-1*(e*sin(c+d*x))^9//2+-10//21*a*d^-1*e^3*(e*sin(c+d*x))^(1/2)*cos(c+d*x)+-2//7*a*e*d^-1*(e*sin(c+d*x))^5//2*cos(c+d*x)+10//21*a*d^-1*e^4*(e*sin(c+d*x))^-1//2*sin(c+d*x)^(1/2)*Elliptic.F((1/2)*c+-1//4*pi+(1/2)*d*x,2))
@test integrate((e*sin(c+d*x))^5//2*(a+b*cos(c+d*x)), x) == :(2//7*b*d^-1*e^-1*(e*sin(c+d*x))^7//2+-2//5*a*e*d^-1*(e*sin(c+d*x))^3//2*cos(c+d*x)+6//5*a*d^-1*e^2*(e*sin(c+d*x))^(1/2)*sin(c+d*x)^-1//2*Elliptic.E((1/2)*c+-1//4*pi+(1/2)*d*x,2))
@test integrate((e*sin(c+d*x))^3//2*(a+b*cos(c+d*x)), x) == :(2//5*b*d^-1*e^-1*(e*sin(c+d*x))^5//2+-2//3*a*e*d^-1*(e*sin(c+d*x))^(1/2)*cos(c+d*x)+2//3*a*d^-1*e^2*(e*sin(c+d*x))^-1//2*sin(c+d*x)^(1/2)*Elliptic.F((1/2)*c+-1//4*pi+(1/2)*d*x,2))
@test integrate((e*sin(c+d*x))^(1/2)*(a+b*cos(c+d*x)), x) == :(2//3*b*d^-1*e^-1*(e*sin(c+d*x))^3//2+2*a*d^-1*(e*sin(c+d*x))^(1/2)*sin(c+d*x)^-1//2*Elliptic.E((1/2)*c+-1//4*pi+(1/2)*d*x,2))
@test integrate((e*sin(c+d*x))^-1//2*(a+b*cos(c+d*x)), x) == :(2*b*d^-1*e^-1*(e*sin(c+d*x))^(1/2)+2*a*d^-1*(e*sin(c+d*x))^-1//2*sin(c+d*x)^(1/2)*Elliptic.F((1/2)*c+-1//4*pi+(1/2)*d*x,2))
@test integrate((e*sin(c+d*x))^-3//2*(a+b*cos(c+d*x)), x) == :(-2*b*d^-1*e^-1*(e*sin(c+d*x))^-1//2+-2*a*d^-1*e^-1*(e*sin(c+d*x))^-1//2*cos(c+d*x)+-2*a*d^-1*e^-2*(e*sin(c+d*x))^(1/2)*sin(c+d*x)^-1//2*Elliptic.E((1/2)*c+-1//4*pi+(1/2)*d*x,2))
@test integrate((e*sin(c+d*x))^-5//2*(a+b*cos(c+d*x)), x) == :(-2//3*b*d^-1*e^-1*(e*sin(c+d*x))^-3//2+-2//3*a*d^-1*e^-1*(e*sin(c+d*x))^-3//2*cos(c+d*x)+2//3*a*d^-1*e^-2*(e*sin(c+d*x))^-1//2*sin(c+d*x)^(1/2)*Elliptic.F((1/2)*c+-1//4*pi+(1/2)*d*x,2))
@test integrate((e*sin(c+d*x))^-7//2*(a+b*cos(c+d*x)), x) == :(-2//5*b*d^-1*e^-1*(e*sin(c+d*x))^-5//2+-6//5*a*d^-1*e^-3*(e*sin(c+d*x))^-1//2*cos(c+d*x)+-2//5*a*d^-1*e^-1*(e*sin(c+d*x))^-5//2*cos(c+d*x)+-6//5*a*d^-1*e^-4*(e*sin(c+d*x))^(1/2)*sin(c+d*x)^-1//2*Elliptic.E((1/2)*c+-1//4*pi+(1/2)*d*x,2))
@test integrate((e*sin(c+d*x))^7//2*(a+b*cos(c+d*x))^2, x) == :(-1//77*e*d^-1*(e*sin(c+d*x))^5//2*(4*b^2+22*a^2)*cos(c+d*x)+-1//231*d^-1*e^3*(e*sin(c+d*x))^(1/2)*(20*b^2+110*a^2)*cos(c+d*x)+2//11*b*d^-1*e^-1*(e*sin(c+d*x))^9//2*(a+b*cos(c+d*x))+26//99*a*b*d^-1*e^-1*(e*sin(c+d*x))^9//2+1//231*d^-1*e^4*(e*sin(c+d*x))^-1//2*sin(c+d*x)^(1/2)*(20*b^2+110*a^2)*Elliptic.F((1/2)*c+-1//4*pi+(1/2)*d*x,2))
@test integrate((e*sin(c+d*x))^5//2*(a+b*cos(c+d*x))^2, x) == :(-1//45*e*d^-1*(e*sin(c+d*x))^3//2*(4*b^2+18*a^2)*cos(c+d*x)+2//9*b*d^-1*e^-1*(e*sin(c+d*x))^7//2*(a+b*cos(c+d*x))+22//63*a*b*d^-1*e^-1*(e*sin(c+d*x))^7//2+1//15*d^-1*e^2*(e*sin(c+d*x))^(1/2)*sin(c+d*x)^-1//2*(4*b^2+18*a^2)*Elliptic.E((1/2)*c+-1//4*pi+(1/2)*d*x,2))
@test integrate((e*sin(c+d*x))^3//2*(a+b*cos(c+d*x))^2, x) == :(-1//21*e*d^-1*(e*sin(c+d*x))^(1/2)*(4*b^2+14*a^2)*cos(c+d*x)+2//7*b*d^-1*e^-1*(e*sin(c+d*x))^5//2*(a+b*cos(c+d*x))+18//35*a*b*d^-1*e^-1*(e*sin(c+d*x))^5//2+1//21*d^-1*e^2*(e*sin(c+d*x))^-1//2*sin(c+d*x)^(1/2)*(4*b^2+14*a^2)*Elliptic.F((1/2)*c+-1//4*pi+(1/2)*d*x,2))
@test integrate((e*sin(c+d*x))^(1/2)*(a+b*cos(c+d*x))^2, x) == :(1//5*d^-1*(e*sin(c+d*x))^(1/2)*sin(c+d*x)^-1//2*(4*b^2+10*a^2)*Elliptic.E((1/2)*c+-1//4*pi+(1/2)*d*x,2)+2//5*b*d^-1*e^-1*(e*sin(c+d*x))^3//2*(a+b*cos(c+d*x))+14//15*a*b*d^-1*e^-1*(e*sin(c+d*x))^3//2)
@test integrate((e*sin(c+d*x))^-1//2*(a+b*cos(c+d*x))^2, x) == :(1//3*d^-1*(e*sin(c+d*x))^-1//2*sin(c+d*x)^(1/2)*(4*b^2+6*a^2)*Elliptic.F((1/2)*c+-1//4*pi+(1/2)*d*x,2)+2//3*b*d^-1*e^-1*(e*sin(c+d*x))^(1/2)*(a+b*cos(c+d*x))+10//3*a*b*d^-1*e^-1*(e*sin(c+d*x))^(1/2))
@test integrate((e*sin(c+d*x))^-3//2*(a+b*cos(c+d*x))^2, x) == :(d^-1*e^-1*(e*sin(c+d*x))^-1//2*(a+b*cos(c+d*x))*(-2b+-2*a*cos(c+d*x))+-2*a*b*d^-1*e^-3*(e*sin(c+d*x))^3//2+-1*d^-1*e^-2*(e*sin(c+d*x))^(1/2)*sin(c+d*x)^-1//2*(2*a^2+4*b^2)*Elliptic.E((1/2)*c+-1//4*pi+(1/2)*d*x,2))
@test integrate((e*sin(c+d*x))^-5//2*(a+b*cos(c+d*x))^2, x) == :(-2//3*a*b*d^-1*e^-3*(e*sin(c+d*x))^(1/2)+1//3*d^-1*e^-1*(e*sin(c+d*x))^-3//2*(a+b*cos(c+d*x))*(-2b+-2*a*cos(c+d*x))+1//3*d^-1*e^-2*(e*sin(c+d*x))^-1//2*sin(c+d*x)^(1/2)*(-4*b^2+2*a^2)*Elliptic.F((1/2)*c+-1//4*pi+(1/2)*d*x,2))
@test integrate((e*sin(c+d*x))^-7//2*(a+b*cos(c+d*x))^2, x) == :(-2//5*a*b*d^-1*e^-3*(e*sin(c+d*x))^-1//2+-1//5*d^-1*e^-3*(e*sin(c+d*x))^-1//2*(-4*b^2+6*a^2)*cos(c+d*x)+1//5*d^-1*e^-1*(e*sin(c+d*x))^-5//2*(a+b*cos(c+d*x))*(-2b+-2*a*cos(c+d*x))+-1//5*d^-1*e^-4*(e*sin(c+d*x))^(1/2)*sin(c+d*x)^-1//2*(-4*b^2+6*a^2)*Elliptic.E((1/2)*c+-1//4*pi+(1/2)*d*x,2))
@test integrate((e*sin(c+d*x))^7//2*(a+b*cos(c+d*x))^3, x) == :(2//13*b*d^-1*e^-1*(e*sin(c+d*x))^9//2*(a+b*cos(c+d*x))^2+2//1287*b*d^-1*e^-1*(e*sin(c+d*x))^9//2*(44*b^2+177*a^2)+-10//231*a*d^-1*e^3*(e*sin(c+d*x))^(1/2)*(6*b^2+11*a^2)*cos(c+d*x)+-2//77*a*e*d^-1*(e*sin(c+d*x))^5//2*(6*b^2+11*a^2)*cos(c+d*x)+34//143*a*b*d^-1*e^-1*(e*sin(c+d*x))^9//2*(a+b*cos(c+d*x))+10//231*a*d^-1*e^4*(e*sin(c+d*x))^-1//2*sin(c+d*x)^(1/2)*(6*b^2+11*a^2)*Elliptic.F((1/2)*c+-1//4*pi+(1/2)*d*x,2))
@test integrate((e*sin(c+d*x))^5//2*(a+b*cos(c+d*x))^3, x) == :(2//11*b*d^-1*e^-1*(e*sin(c+d*x))^7//2*(a+b*cos(c+d*x))^2+2//231*b*d^-1*e^-1*(e*sin(c+d*x))^7//2*(12*b^2+43*a^2)+-2//15*a*e*d^-1*(e*sin(c+d*x))^3//2*(2*b^2+3*a^2)*cos(c+d*x)+10//33*a*b*d^-1*e^-1*(e*sin(c+d*x))^7//2*(a+b*cos(c+d*x))+2//5*a*d^-1*e^2*(e*sin(c+d*x))^(1/2)*sin(c+d*x)^-1//2*(2*b^2+3*a^2)*Elliptic.E((1/2)*c+-1//4*pi+(1/2)*d*x,2))
@test integrate((e*sin(c+d*x))^3//2*(a+b*cos(c+d*x))^3, x) == :(2//9*b*d^-1*e^-1*(e*sin(c+d*x))^5//2*(a+b*cos(c+d*x))^2+2//315*b*d^-1*e^-1*(e*sin(c+d*x))^5//2*(28*b^2+89*a^2)+-2//21*a*e*d^-1*(e*sin(c+d*x))^(1/2)*(6*b^2+7*a^2)*cos(c+d*x)+26//63*a*b*d^-1*e^-1*(e*sin(c+d*x))^5//2*(a+b*cos(c+d*x))+2//21*a*d^-1*e^2*(e*sin(c+d*x))^-1//2*sin(c+d*x)^(1/2)*(6*b^2+7*a^2)*Elliptic.F((1/2)*c+-1//4*pi+(1/2)*d*x,2))
@test integrate((e*sin(c+d*x))^(1/2)*(a+b*cos(c+d*x))^3, x) == :(2//7*b*d^-1*e^-1*(e*sin(c+d*x))^3//2*(a+b*cos(c+d*x))^2+2//105*b*d^-1*e^-1*(e*sin(c+d*x))^3//2*(20*b^2+57*a^2)+2//5*a*d^-1*(e*sin(c+d*x))^(1/2)*sin(c+d*x)^-1//2*(5*a^2+6*b^2)*Elliptic.E((1/2)*c+-1//4*pi+(1/2)*d*x,2)+22//35*a*b*d^-1*e^-1*(e*sin(c+d*x))^3//2*(a+b*cos(c+d*x)))
@test integrate((e*sin(c+d*x))^-1//2*(a+b*cos(c+d*x))^3, x) == :(2//5*b*d^-1*e^-1*(e*sin(c+d*x))^(1/2)*(a+b*cos(c+d*x))^2+2//5*b*d^-1*e^-1*(e*sin(c+d*x))^(1/2)*(4*b^2+11*a^2)+2*a*d^-1*(e*sin(c+d*x))^-1//2*sin(c+d*x)^(1/2)*(a^2+2*b^2)*Elliptic.F((1/2)*c+-1//4*pi+(1/2)*d*x,2)+6//5*a*b*d^-1*e^-1*(e*sin(c+d*x))^(1/2)*(a+b*cos(c+d*x)))
@test integrate((e*sin(c+d*x))^-3//2*(a+b*cos(c+d*x))^3, x) == :(-1*d^-1*e^-1*(e*sin(c+d*x))^-1//2*(a+b*cos(c+d*x))^2*(2b+2*a*cos(c+d*x))+-2//3*b*d^-1*e^-3*(e*sin(c+d*x))^3//2*(3*a^2+4*b^2)+-2*a*b*d^-1*e^-3*(e*sin(c+d*x))^3//2*(a+b*cos(c+d*x))+-2*a*d^-1*e^-2*(e*sin(c+d*x))^(1/2)*sin(c+d*x)^-1//2*(a^2+6*b^2)*Elliptic.E((1/2)*c+-1//4*pi+(1/2)*d*x,2))
@test integrate((e*sin(c+d*x))^-5//2*(a+b*cos(c+d*x))^3, x) == :(-2//3*b*d^-1*e^-3*(e*sin(c+d*x))^(1/2)*(a^2+4*b^2)+-1//3*d^-1*e^-1*(e*sin(c+d*x))^-3//2*(a+b*cos(c+d*x))^2*(2b+2*a*cos(c+d*x))+-2//3*a*b*d^-1*e^-3*(e*sin(c+d*x))^(1/2)*(a+b*cos(c+d*x))+2//3*a*d^-1*e^-2*(e*sin(c+d*x))^-1//2*sin(c+d*x)^(1/2)*(a^2+-6*b^2)*Elliptic.F((1/2)*c+-1//4*pi+(1/2)*d*x,2))
@test integrate((e*sin(c+d*x))^-7//2*(a+b*cos(c+d*x))^3, x) == :(-2//5*b*d^-1*e^-5*(e*sin(c+d*x))^3//2*(-4*b^2+3*a^2)+-1//5*d^-1*e^-1*(e*sin(c+d*x))^-5//2*(a+b*cos(c+d*x))^2*(2b+2*a*cos(c+d*x))+1//5*d^-1*e^-3*(e*sin(c+d*x))^-1//2*(2a+2*b*cos(c+d*x))*(a*b+-1*(-4*b^2+3*a^2)*cos(c+d*x))+-6//5*a*d^-1*e^-4*(e*sin(c+d*x))^(1/2)*sin(c+d*x)^-1//2*(a^2+-2*b^2)*Elliptic.E((1/2)*c+-1//4*pi+(1/2)*d*x,2))
@test integrate((e*sin(c+d*x))^-9//2*(a+b*cos(c+d*x))^3, x) == :(-2//21*b*d^-1*e^-5*(e*sin(c+d*x))^(1/2)*(-4*b^2+5*a^2)+-1//7*d^-1*e^-1*(e*sin(c+d*x))^-7//2*(a+b*cos(c+d*x))^2*(2b+2*a*cos(c+d*x))+-1//21*d^-1*e^-3*(e*sin(c+d*x))^-3//2*(2a+2*b*cos(c+d*x))*(a*b+(-4*b^2+5*a^2)*cos(c+d*x))+2//21*a*d^-1*e^-4*(e*sin(c+d*x))^-1//2*sin(c+d*x)^(1/2)*(-6*b^2+5*a^2)*Elliptic.F((1/2)*c+-1//4*pi+(1/2)*d*x,2))
